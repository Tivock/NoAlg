YUI.add("hermes-template-result-card",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,e,a){return" linked"},3:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t<div class="coverphoto-gradient"></div>\n\t\t<div class="cover" style="background-image:url('+n.escapeExpression("function"==typeof(r=null!=(r=o(t,"coverPhotoUrl")||(null!=l?o(l,"coverPhotoUrl"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"coverPhotoUrl",hash:{},data:a,loc:{start:{line:4,column:49},end:{line:4,column:66}}}):r)+')"></div>\n'},5:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<a href="'+n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"avatar"):l)?o(r,"link"):r,l))+'" data-track="groupCardOtherClick">'},7:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return' data-group-nsid="'+n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"avatar"):l)?o(r,"groupNsid"):r,l))+'" '},9:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return' data-person-nsid="'+n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"avatar"):l)?o(r,"personNsid"):r,l))+'" '},11:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"avatar"):l)?o(r,"size"):r,l))},13:function(n,l,t,e,a){return"medium"},15:function(n,l,t,e,a){return"</a>"},17:function(n,l,t,e,a){var r,o=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<div class="subtitle">\n\t\t\t\t\t'+(null!=(r=u(t,"if").call(o,null!=l?u(l,"isPro"):l,{name:"if",hash:{},fn:n.program(18,a,0),inverse:n.noop,data:a,loc:{start:{line:16,column:5},end:{line:16,column:89}}}))?r:"")+"\n\t\t\t\t\t"+(null!=(r=u(t,"each").call(o,null!=l?u(l,"subtitles"):l,{name:"each",hash:{},fn:n.program(20,a,0),inverse:n.noop,data:a,loc:{start:{line:17,column:5},end:{line:17,column:51}}}))?r:"")+"\n\t\t\t\t</div>\n"},18:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=n.invokePartial(o(e,"pro-badge"),l,{name:"pro-badge",hash:{purchaseProURL:null!=l?o(l,"upgradeProLink"):l,badgeType:null!=l?o(l,"proBadge"):l},data:a,helpers:t,partials:e,decorators:n.decorators}))?r:""},20:function(n,l,t,e,a){return"<span>"+n.escapeExpression(n.lambda(l,l))+"</span>"},22:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=o(t,"if").call(null!=l?l:n.nullContext||{},null!=l?o(l,"subtitle"):l,{name:"if",hash:{},fn:n.program(23,a,0),inverse:n.noop,data:a,loc:{start:{line:21,column:4},end:{line:24,column:11}}}))?r:""},23:function(n,l,t,e,a){var r,o,u=null!=l?l:n.nullContext||{},i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t\t"+(null!=(r=i(t,"if").call(u,null!=l?i(l,"isPro"):l,{name:"if",hash:{},fn:n.program(18,a,0),inverse:n.noop,data:a,loc:{start:{line:22,column:5},end:{line:22,column:89}}}))?r:"")+'\n\t\t\t\t\t<div class="subtitle">'+n.escapeExpression("function"==typeof(o=null!=(o=i(t,"subtitle")||(null!=l?i(l,"subtitle"):l))?o:n.hooks.helperMissing)?o.call(u,{name:"subtitle",hash:{},data:a,loc:{start:{line:23,column:27},end:{line:23,column:39}}}):o)+"</div>\n"},25:function(n,l,t,e,a){var r,o=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<div class="links">\n\t\t\t\t\t'+(null!=(r=u(t,"each").call(o,null!=l?u(l,"links"):l,{name:"each",hash:{},fn:n.program(26,a,0),inverse:n.noop,data:a,loc:{start:{line:28,column:5},end:{line:28,column:162}}}))?r:"")+"\n\t\t\t\t\t"+(null!=(r=u(t,"if").call(o,null!=l?u(l,"linksMetadata"):l,{name:"if",hash:{},fn:n.program(29,a,0),inverse:n.noop,data:a,loc:{start:{line:29,column:5},end:{line:29,column:86}}}))?r:"")+"\n\t\t\t\t</div>\n"},26:function(n,l,t,e,a){var r,o=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"<span>"+(null!=(r=u(t,"if").call(o,null!=l?u(l,"url"):l,{name:"if",hash:{},fn:n.program(27,a,0),inverse:n.noop,data:a,loc:{start:{line:28,column:26},end:{line:28,column:96}}}))?r:"")+n.escapeExpression((u(t,"renderTrustedMarkup")||l&&u(l,"renderTrustedMarkup")||n.hooks.helperMissing).call(o,null!=l?u(l,"text"):l,{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:28,column:96},end:{line:28,column:124}}}))+(null!=(r=u(t,"if").call(o,null!=l?u(l,"url"):l,{name:"if",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:28,column:124},end:{line:28,column:146}}}))?r:"")+"</span>"},27:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<a data-track="groupCardOtherClick"  href="'+n.escapeExpression("function"==typeof(r=null!=(r=o(t,"url")||(null!=l?o(l,"url"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"url",hash:{},data:a,loc:{start:{line:28,column:80},end:{line:28,column:87}}}):r)+'">'},29:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<span class="links-metadata">'+n.escapeExpression("function"==typeof(r=null!=(r=o(t,"linksMetadata")||(null!=l?o(l,"linksMetadata"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"linksMetadata",hash:{},data:a,loc:{start:{line:29,column:55},end:{line:29,column:72}}}):r)+"</span>"},31:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<a href="'+n.escapeExpression("function"==typeof(r=null!=(r=o(t,"link")||(null!=l?o(l,"link"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"link",hash:{},data:a,loc:{start:{line:34,column:12},end:{line:34,column:20}}}):r)+'" data-track="groupCardOtherClick" class="click-anywhere"></a>\n'},33:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t<div class="button-content">\n'+(null!=(r=o(t,"if").call(null!=l?l:n.nullContext||{},null!=(r=null!=l?o(l,"cta"):l)?o(r,"staticButton"):r,{name:"if",hash:{},fn:n.program(34,a,0),inverse:n.program(37,a,0),data:a,loc:{start:{line:39,column:3},end:{line:53,column:10}}}))?r:"")+"\t\t</div>\n"},34:function(n,l,t,e,a){var r,o=n.lambda,u=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<a class="butt join '+(null!=(r=i(t,"if").call(null!=l?l:n.nullContext||{},null!=(r=null!=l?i(l,"cta"):l)?i(r,"hasJoined"):r,{name:"if",hash:{},fn:n.program(35,a,0),inverse:n.noop,data:a,loc:{start:{line:40,column:24},end:{line:40,column:64}}}))?r:"")+'" href="'+u(o(null!=(r=null!=(r=null!=l?i(l,"cta"):l)?i(r,"staticButton"):r)?i(r,"url"):r,l))+'">'+u(o(null!=(r=null!=(r=null!=l?i(l,"cta"):l)?i(r,"staticButton"):r)?i(r,"text"):r,l))+"</a>\n"},35:function(n,l,t,e,a){return" has-joined "},37:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=o(t,"if").call(null!=l?l:n.nullContext||{},null!=(r=null!=l?o(l,"cta"):l)?o(r,"joinPlaceholderId"):r,{name:"if",hash:{},fn:n.program(38,a,0),inverse:n.program(40,a,0),data:a,loc:{start:{line:42,column:4},end:{line:52,column:11}}}))?r:""},38:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t\t<span id="'+n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"cta"):l)?o(r,"joinPlaceholderId"):r,l))+'"></span>\n'},40:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=o(t,"if").call(null!=l?l:n.nullContext||{},null!=(r=null!=l?o(l,"cta"):l)?o(r,"followPlaceholderId"):r,{name:"if",hash:{},fn:n.program(41,a,0),inverse:n.program(43,a,0),data:a,loc:{start:{line:46,column:5},end:{line:51,column:12}}}))?r:""},41:function(n,l,t,e,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t\t<span id="'+n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"cta"):l)?o(r,"followPlaceholderId"):r,l))+'"></span>\n'},43:function(n,l,t,e,a){var r,o=n.lambda,u=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t\t\t<button"+(null!=(r=i(t,"if").call(null!=l?l:n.nullContext||{},null!=(r=null!=l?i(l,"avatar"):l)?i(r,"personNsid"):r,{name:"if",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:50,column:13},end:{line:50,column:87}}}))?r:"")+' class="'+u(o(null!=(r=null!=l?i(l,"cta"):l)?i(r,"type"):r,l))+' mini not-follow-view">'+u(o(null!=(r=null!=l?i(l,"cta"):l)?i(r,"text"):r,l))+"</button>\n"},compiler:[8,">= 4.3.0"],main:function(n,l,t,e,a){var r,o=null!=l?l:n.nullContext||{},u=n.lambda,i=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<div class="result-card'+(null!=(r=c(t,"if").call(o,null!=l?c(l,"link"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:23},end:{line:1,column:49}}}))?r:"")+' reboot-restyle">\n'+(null!=(r=c(t,"if").call(o,null!=l?c(l,"coverPhotoUrl"):l,{name:"if",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:1},end:{line:5,column:8}}}))?r:"")+'\t<div class="sizer-cropper" title="'+i(u(null!=(r=null!=l?c(l,"title"):l)?c(r,"text"):r,l))+'">\n\t\t<div class="avatar-content">\n\t\t\t'+(null!=(r=c(t,"if").call(o,null!=(r=null!=l?c(l,"avatar"):l)?c(r,"link"):r,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:8,column:3},end:{line:8,column:88}}}))?r:"")+"\n\t\t\t\t<div"+(null!=(r=c(t,"if").call(o,null!=(r=null!=l?c(l,"avatar"):l)?c(r,"groupNsid"):r,{name:"if",hash:{},fn:n.program(7,a,0),inverse:n.noop,data:a,loc:{start:{line:9,column:8},end:{line:9,column:79}}}))?r:"")+(null!=(r=c(t,"if").call(o,null!=(r=null!=l?c(l,"avatar"):l)?c(r,"personNsid"):r,{name:"if",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:9,column:79},end:{line:9,column:153}}}))?r:"")+' class="'+i(u(null!=(r=null!=l?c(l,"avatar"):l)?c(r,"noMenu"):r,l))+" avatar "+i(u(null!=(r=null!=l?c(l,"avatar"):l)?c(r,"type"):r,l))+" "+(null!=(r=c(t,"if").call(o,null!=(r=null!=l?c(l,"avatar"):l)?c(r,"size"):r,{name:"if",hash:{},fn:n.program(11,a,0),inverse:n.program(13,a,0),data:a,loc:{start:{line:9,column:202},end:{line:9,column:257}}}))?r:"")+'" title="'+i(u(null!=(r=null!=l?c(l,"avatar"):l)?c(r,"title"):r,l))+'" data-track="groupCardOtherClick" style="background-image: url('+i(u(null!=(r=null!=l?c(l,"avatar"):l)?c(r,"url"):r,l))+');"></div>\n\t\t\t'+(null!=(r=c(t,"if").call(o,null!=(r=null!=l?c(l,"avatar"):l)?c(r,"link"):r,{name:"if",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:3},end:{line:10,column:33}}}))?r:"")+'\n\t\t</div>\n\t\t<div class="text-content">\n\t\t\t<div data-track="groupCardOtherClick" class="title">'+i(u(null!=(r=null!=l?c(l,"title"):l)?c(r,"text"):r,l))+"</div>\n"+(null!=(r=c(t,"if").call(o,null!=l?c(l,"subtitles"):l,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:14,column:3},end:{line:19,column:10}}}))?r:"")+(null!=(r=c(t,"unless").call(o,null!=l?c(l,"subtitles"):l,{name:"unless",hash:{},fn:n.program(22,a,0),inverse:n.noop,data:a,loc:{start:{line:20,column:3},end:{line:25,column:14}}}))?r:"")+(null!=(r=c(t,"if").call(o,(c(t,"or")||l&&c(l,"or")||n.hooks.helperMissing).call(o,null!=l?c(l,"linksMetadata"):l,null!=l?c(l,"links"):l,{name:"or",hash:{},data:a,loc:{start:{line:26,column:9},end:{line:26,column:33}}}),{name:"if",hash:{},fn:n.program(25,a,0),inverse:n.noop,data:a,loc:{start:{line:26,column:3},end:{line:31,column:10}}}))?r:"")+"\t\t</div>\n"+(null!=(r=c(t,"if").call(o,null!=l?c(l,"link"):l,{name:"if",hash:{},fn:n.program(31,a,0),inverse:n.noop,data:a,loc:{start:{line:33,column:2},end:{line:35,column:9}}}))?r:"")+"\t</div>\n"+(null!=(r=c(t,"if").call(o,null!=l?c(l,"cta"):l,{name:"if",hash:{},fn:n.program(33,a,0),inverse:n.noop,data:a,loc:{start:{line:37,column:1},end:{line:55,column:8}}}))?r:"")+"</div>\n"},usePartial:!0,useData:!0}),e={};n.Array.each(["pro-badge","pro-badge"],(function(l){var t=n.Template.get("hermes/"+l);t&&(e[l]=t)})),n.Template.register("hermes/result-card",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(e,a.partials):e,t(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge","hermes-template-pro-badge"]});YUI.add("hermes-template-result-cards",(function(e,r){var a=e.Template.Handlebars.revive({1:function(e,r,a,t,l){var n,s=e.lookupProperty||function(e,r){if(Object.prototype.hasOwnProperty.call(e,r))return e[r]};return null!=(n=e.invokePartial(s(t,"result-card"),r,{name:"result-card",data:l,indent:"\t",helpers:a,partials:t,decorators:e.decorators}))?n:""},compiler:[8,">= 4.3.0"],main:function(e,r,a,t,l){var n,s=e.lookupProperty||function(e,r){if(Object.prototype.hasOwnProperty.call(e,r))return e[r]};return null!=(n=s(a,"each").call(null!=r?r:e.nullContext||{},null!=r?s(r,"results"):r,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:1,column:0},end:{line:3,column:9}}}))?n:""},usePartial:!0,useData:!0}),t={};e.Array.each(["result-card"],(function(r){var a=e.Template.get("hermes/"+r);a&&(t[r]=a)})),e.Template.register("hermes/result-cards",(function(r,l){return(l=l||{}).partials=l.partials?e.merge(t,l.partials):t,a(r,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-result-card"]});YUI.add("search-sidebar-group-search-view",(function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("search-sidebar-group-search-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.searchTerm=t.searchTerm;let s={},r={text:this.searchTerm};this.searchUrl=new e.SearchUrl(r,this.appContext,e.SearchUrl.searchTypes.GROUPS),s.all={id:this.searchUrl.getId()+"-sidebar",apiParams:e.merge(this.searchUrl.getAPIParams(),{perPage:2,page:1,safe_search:1,extras:e.APIHelper.request.getRebootGroupExtras()+",use_vespa,membership_info,icon_urls,pool_recent,sizes,pool_recent,safety_level"})},this.searchParams=s,this.safeSearchPref=1},loadState:function(){let t=this.appContext.getModel("search-groups-models",this.searchParams.all.id,this.searchParams.all.apiParams).then(function(e){e.getValue("groups").totalItems>0?(this.groupRecs=e.getValue("groups").getList(),this.set("groupsResults",this.groupRecs),this.set("noResults",!1)):(this.set("noResults",!0),this.disableSubview=!0)}.bind(this)).catch(function(e){this.set("noResults",!0),this.disableSubview=!0}.bind(this));return e.Promise.resolve(t)},buildContainer:function(){this.setContainerWithTemplate("search-sidebar-group-search",{noResults:this.get("noResults",!0),searchUrl:this.searchUrl.getURL()})},activate:function(){this.listContainerNode=this.get("container").one(".list-container"),this.get("noResults")||(this.get("groupsResults").forEach((e=>{let t=e.getValue("photos").filter((e=>!e.needsInterstitial&&parseInt(e.safetyLevel,10)<=this.safeSearchPref));e.setValue("photos",t),this.buildGroupLayout(e.toJSON())})),e.Snowplough&&this.registerEventHandler(this.listContainerNode.on("click",(function(){e.Snowplough.sendStructuredEvent({category:"searchSidebar",action:"relatedGroupsClick",label:""})}))))},buildGroupLayout:function(e){var t=this;this.appContext.getView("group-recs-rail-item-view",Object.assign({appContext:this.appContext,buddyicon:e.iconurls},e)).then((function(e){return e.initialize()})).then((function(e){return t.listContainerNode.appendChild(e.get("container")),e.activate()}))}})}),"@VERSION@",{requires:["flickr-view","hermes-template-search-sidebar-group-search","hermes-template-result-cards","hermes-template-result-card","group-recs-rail-item-view","join-group-view","photo-size-helper"],langBundles:["common","search","groups"]});YUI.add("search-sidebar-view",(function(e,i){var r=require("hermes-core/flog")(i);const t=new e.SubscriptionsHelper;e.namespace("Views")[this.name]=e.Base.create("search-sidebar-view",e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"search-sidebar-related-tags-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"search-sidebar-group-search-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"search-sidebar-photos-search-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"search-photos-everyone-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"slim-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},initializer:function(e){this.params=e,this.nsid=this.appContext.getViewer().nsid,this.showMonthlyOffer=!1,this.prevScrollTop=0,this.scrollDir=-1,this.railSpacerMargin=0,this.railItems=[],this.railCardViews={},this.isPhotosSearch=e.isPhotosSearch||!1,this.isPeopleSearch=e.isPeopleSearch||!1,this.isGroupSearch=e.isGroupSearch||!1,this.railCardOrderKeys=["related-tags","monthlyProOffer","photos-search","group-search","ad"]},loadState:function(){return this.isPeopleSearch?this.railItems=["related-tags","ad"]:this.isGroupSearch?this.railItems=["related-tags","photos-search","ad"]:this.railItems=["related-tags","group-search","ad"],this.appContext.flipper.isFlipped("enable-monthly-2ypro-offer")?this.appContext.getModel("effective-subscriptions-models",this.nsid).then(function(e){if(e&&e.getValue("length")>0){var i=t.getEligibleSubscription(e,!0);!i||i.isGoogleOrAppleSubscription||i.futureChanges&&i.futureChanges.hasDiscount&&i.futureChanges.type===t.FLICKR_PRO_STRIPE_2_YEAR_PLAN_ID||(this.showMonthlyOffer=t.isAMonthlySub(i.type))}}.bind(this)):e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("search-sidebar")},activate:function(){var i=this,r=this.get("container");return this.railItemsContainerNode=r.one(".rail-items-container"),this.railContentContainer=r.one(".sidebar-content-container"),this.dummyLoaderNode=r.one(".dummy-loader"),this.appContext.flipper.isFlipped("enable-search-sidebar")&&(this.scrollContainer=e.one("html"),this.sidebarColumnNode=e.one(".sidebar-column"),this.sidebarColumnSpacer=e.one(".sidebar-column-spacer"),this.sidebarColumnContentNode=e.one(".sidebar-content-container"),this.registerEventHandler(e.globalEvents.subscribe("window:scroll:nothrottle",this.handleScrollUnthrottled.bind(this)))),i.getSubviews().then((function(){return i.toggleLoading(!1),i.insertSubviews()}))},getSubviews:function(){var i=this,r=[],t={};return i.railItems.includes("related-tags")&&(t={searchTerm:this.params.searchTerm},r.push(this.appContext.getView("search-sidebar-related-tags-view",t).then((function(e){return i.railCardViews["related-tags"]=e,e})).catch((function(e){return e})))),this.showMonthlyOffer&&(t={searchTerm:this.params.searchTerm,promoURL:"/account/upgrade/pro/pro-2-year?coupon=morefun20&utm_campaign=2-year-subs&utm_source=Flickr&utm_medium=house_ads&utm_content=sidebarsearch"},r.push(this.appContext.getView("monthly-pro-offer-card-view",t).then((function(e){return i.railCardViews.monthlyProOffer=e,e})).catch((function(e){return e})))),i.railItems.includes("group-search")&&(t={searchTerm:this.params.searchTerm},r.push(this.appContext.getView("search-sidebar-group-search-view",t).then((function(e){return i.railCardViews["group-search"]=e,e})).catch((function(e){return e})))),i.railItems.includes("photos-search")&&(t={searchTerm:this.params.searchTerm},r.push(this.appContext.getView("search-sidebar-photos-search-view",t).then((function(e){return i.railCardViews["photos-search"]=e,e})).catch((function(e){return e})))),this.appContext.getViewer().isPro||r.push(this.appContext.getView("sidebar-moola-view",{}).then((function(e){return i.railCardViews.ad=e,e})).catch((function(e){return e}))),e.Promise.all(r)},insertSubviews:function(){var i=this,t=[],s=[];return this.railCardOrderKeys.forEach((function(e){var r=i.railCardViews[e];if(r){var a={cardView:r,theme:"ad"===e?"flat":void 0};s.push(a),t.push(r.initialize().catch((function(e){return s.splice(s.indexOf(a),1),e})))}})),e.Promise.all(t).then((function(){var t=[];return s.forEach((function(s){var a=e.Node.create('<div class="rail-item"></div>');s.theme&&a.addClass(s.theme),s.cardView.disableSubview||(a.append(s.cardView.get("container")),i.railItemsContainerNode.append(a),t.push(new e.Promise((function(e,i){return s.cardView.activate()})).catch((function(e){r.error("Error inserting rail card",{err:e}),s.cardView.destroy({remove:!0}),a.remove()}))))})),e.Promise.all(t)}))},toggleLoading:function(e){this.railContentContainer.toggleClass("invisible",e),this.dummyLoaderNode.toggleClass("hidden",!e)},handleScrollUnthrottled:function(){var i,r=this.scrollContainer.get("scrollTop"),t=this.appContext.viewportData.getHeight(),s=e.AnchorRepositioner.getTotalOffset(),a=s+(this.isPhotosSearch?100:60);if(this.prevScrollTop>r){if(1===this.scrollDir){if(i=this.sidebarColumnNode.get("offsetTop"),this.railHeight=this.sidebarColumnContentNode.get("clientHeight"),this.railHeight<t-a)return this.sidebarColumnContentNode.setStyle("top",a),this.railSpacerMargin=0,void this.sidebarColumnSpacer.setStyle("margin-top",this.railSpacerMargin);r+t-s-i>this.railHeight+this.railSpacerMargin&&(this.railSpacerMargin=Math.max(0,r+t-this.railHeight-i),this.sidebarColumnSpacer.setStyle("margin-top",this.railSpacerMargin)),this.scrollDir=-1,this.sidebarColumnContentNode.setStyle("bottom",t-this.railHeight-a),this.sidebarColumnContentNode.setStyle("top","initial")}}else if(this.prevScrollTop<r&&-1===this.scrollDir){if(i=this.sidebarColumnNode.get("offsetTop"),this.railHeight=this.sidebarColumnContentNode.get("clientHeight"),this.railHeight<t-a)return this.sidebarColumnContentNode.setStyle("top",a),this.railSpacerMargin=0,void this.sidebarColumnSpacer.setStyle("margin-top",this.railSpacerMargin);r-i+a<this.railSpacerMargin&&(this.railSpacerMargin=Math.max(0,r-i+a),this.sidebarColumnSpacer.setStyle("margin-top",this.railSpacerMargin)),this.scrollDir=1,this.sidebarColumnContentNode.setStyle("bottom","initial"),this.sidebarColumnContentNode.setStyle("top",t-this.railHeight)}this.prevScrollTop=r}})}),"@VERSION@",{requires:["flickr-view","sidebar-moola-view","hermes-template-search-sidebar","search-sidebar-related-tags-view","search-photos-everyone-view","search-sidebar-photos-search-view","search-sidebar-group-search-view","monthly-pro-offer-card-view","subscriptions-helper","slim-footer-view"],langBundles:["common"]});YUI.add("hermes-template-search-filter-tools",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,a,r){var o,t=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t<div class="dropdown-link filter-license"><p class="option-header">'+e.escapeExpression("function"==typeof(o=null!=(o=t(l,"license")||(null!=n?t(n,"license"):n))?o:e.hooks.helperMissing)?o.call(null!=n?n:e.nullContext||{},{name:"license",hash:{},data:r,loc:{start:{line:2,column:68},end:{line:2,column:79}}}):o)+'</p><span class="dropdown-arrow"></span></div>\n'},3:function(e,n,l,a,r){var o,t=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t<div class="dropdown-link filter-safe-search"><p class="option-header">'+e.escapeExpression("function"==typeof(o=null!=(o=t(l,"safeSearch")||(null!=n?t(n,"safeSearch"):n))?o:e.hooks.helperMissing)?o.call(null!=n?n:e.nullContext||{},{name:"safeSearch",hash:{},data:r,loc:{start:{line:5,column:72},end:{line:5,column:86}}}):o)+'</p><span class="dropdown-arrow"></span></div>\n'},compiler:[8,">= 4.3.0"],main:function(e,n,l,a,r){var o,t=null!=n?n:e.nullContext||{},s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return(null!=(o=s(l,"if").call(t,null!=n?s(n,"showLicenseFilter"):n,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:0},end:{line:3,column:7}}}))?o:"")+(null!=(o=s(l,"if").call(t,null!=n?s(n,"showSafeSearchFilter"):n,{name:"if",hash:{},fn:e.program(3,r,0),inverse:e.noop,data:r,loc:{start:{line:4,column:0},end:{line:6,column:7}}}))?o:"")},useData:!0}),a={};e.Array.each([],(function(n){var l=e.Template.get("hermes/"+n);l&&(a[n]=l)})),e.Template.register("hermes/search-filter-tools",(function(n,r){return(r=r||{}).partials=r.partials?e.merge(a,r.partials):a,l(n,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-filter-tools-view",(function(e){var t=[{intlKey:"search.ANY_LICENSE",value:"any",isDefault:!0},{intlKey:"search.ALL_CC",value:"2,3,4,5,6,9"},{intlKey:"search.COMMERCIAL_USE",value:"4,5,6,9,10"},{intlKey:"search.MODS_ALLOWED",value:"1,2,9,10"},{intlKey:"search.COMMERCIAL_USE_MODS",value:"4,5,9,10"},{intlKey:"search.NO_RESTRICTIONS",value:"7,9,10",isCommonsLicense:!0},{intlKey:"search.PUBLIC_DOMAIN_DEDICATION",value:"9",notInDropdown:!0},{intlKey:"search.PUBLIC_DOMAIN_WORK",value:"10",notInDropdown:!0},{intlKey:"search.US_GOVT",value:"8"}],s=[{intlKey:"search.SAFESEARCH_ON",value:"1",prefValue:0,isDefault:!0},{intlKey:"search.SAFESEARCH_MODERATE",value:"2",prefValue:1},{intlKey:"search.SAFESEARCH_OFF",value:"3",prefValue:2}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(a){var r,i,n,l,c,h,o=this;return this.searchUrl=a.searchUrl?a.searchUrl:new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),r=this.searchUrl.getAPIParam(e.SearchHelper.API.safeSearch),i=this.searchUrl.getAPIParam(e.SearchHelper.API.license),h=this.searchUrl.getAPIParam(e.SearchHelper.API.commons),i&&(n=e.SearchHelper.deriveCCLicenseString(this.searchUrl.getAPIParams()))&&this.set("selectedLicenseText",this.intlMessage(n)),this.safeSearches=[],s.forEach((function(t){l=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),r?l.value===r&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text),o.usedAPISafeSearch=!0):l.isDefault&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text)),o.safeSearches.push(l)})),this.licenses=[],t.forEach((function(t){c=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),t.itemFlag&&(c.itemFlag=o.intlMessage({intlName:t.itemFlag})),i?c.value===i&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):"true"===h||parseInt(h)?c.isCommonsLicense&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):c.isDefault&&!o.searchUrl.getAPIParam(e.SearchHelper.API.marketplace)&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)),c&&!c.notInDropdown&&o.licenses.push(c)})),this.set("showLicenseFilter",a.showLicenseFilter),this.set("showSafeSearchFilter",a.showSafeSearchFilter),this},loadState:function(){var t=this,s=[];return this.appContext.getViewer().signedIn&&s.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then((function(e){t.set("viewerPrefsModel",e),t.safeSearches.forEach((function(s){s.isDefault=!1,t.usedAPISafeSearch||(s.isSelected=!1),s.prefValue===e.getValue("safeSearch")&&(t.usedAPISafeSearch||(s.isSelected=!0,t.set("selectedSafeSearch",s.value),t.set("selectedSafeSearchText",s.text)),s.isDefault=!0)}))}))),e.Promise.all(s)},buildContainer:function(){return this.setContainerWithTemplate("search-filter-tools",{showLicenseFilter:this.get("showLicenseFilter"),license:this.get("selectedLicenseText"),showSafeSearchFilter:this.get("showSafeSearchFilter"),safeSearch:this.get("selectedSafeSearchText")}),this},activate:function(){var e=this.get("container"),t=e.one(".filter-license"),s=e.one(".filter-safe-search");return t&&this.registerEventHandler(t.on("click",this.handleFilterLicense.bind(this))),s&&this.registerEventHandler(s.on("click",this.handleFilterSafeSearch.bind(this))),this},handleFilterLicense:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,menuItems:this.licenses}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",(function(e){e&&e.menuItem&&e.menuItem.value!==s.get("selectedLicense")&&(s.set("selectedLicense",e.menuItem.value),s.set("selectedLicenseText",e.menuItem.text),s.get("container").one(".filter-license p").set("text",s.get("selectedLicenseText")),s.processUpdate()),s.dropdown.close()})))},handleFilterSafeSearch:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,menuItems:this.safeSearches}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",(function(e){if(e&&e.menuItem){if(!this.appContext.getViewer().signedIn&&(2===parseInt(e.menuItem.value,10)||3===parseInt(e.menuItem.value,10)))return s.dropdown.close(),void s.showSignUpModal();s.set("selectedSafeSearch",e.menuItem.value),s.set("selectedSafeSearchText",e.menuItem.text),s.get("container").one(".filter-safe-search p").set("text",s.get("selectedSafeSearchText")),s.processUpdate()}s.dropdown.close()})))},processUpdate:function(){this.isDefaultLicenseValue()?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)):"marketplace"===this.get("selectedLicense")?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.setAPIParam(e.SearchHelper.API.marketplace,"1")):(this.searchUrl.setAPIParam(e.SearchHelper.API.license,this.get("selectedLicense")),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)),this.isDefaultSafeSearchValue()?this.searchUrl.removeAPIParam(e.SearchHelper.API.safeSearch):this.searchUrl.setAPIParam(e.SearchHelper.API.safeSearch,this.get("selectedSafeSearch")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},isDefaultLicenseValue:function(){var e=this;return this.licenses.reduce((function(t,s){return t||s.isDefault&&s.value===e.get("selectedLicense")}),!1)},isDefaultSafeSearchValue:function(){var e=this;return this.safeSearches.reduce((function(t,s){return t||s.isDefault&&s.value===e.get("selectedSafeSearch")}),!1)},showSignUpModal:function(){var t,s=e.config.win.location.href,a=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_TITLE"}),r=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_MESSAGE"});(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-search-mature",signUpTitle:a,signUpMessage:r,beaconPrefix:"searchFilter"})).on("signUpClick",(function(t){e.SigninHelper._redirectToSignUp("",{postLoginUrl:s})})),t.on("signInClick",(function(t){e.SigninHelper._redirectToSignin("",{postLoginUrl:s})})),t.show()}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-search-filter-tools","search-helper"],langBundles:["search","common"]});YUI.add("hermes-template-basic-closeable-header",(function(e,l){var n=e.Template.Handlebars.revive({1:function(e,l,n,a,t){return'\t\t<a role="button" class="close-x-button">\n\t\t\t<svg class="icon icon-close"><use xlink:href="#icon-close"></use></svg>\n\t\t</a>\n'},compiler:[8,">= 4.3.0"],main:function(e,l,n,a,t){var r,s,o=null!=l?l:e.nullContext||{},i=e.lookupProperty||function(e,l){if(Object.prototype.hasOwnProperty.call(e,l))return e[l]};return'<header class="basic-closeable-header">\n\t<h4>'+e.escapeExpression("function"==typeof(s=null!=(s=i(n,"title")||(null!=l?i(l,"title"):l))?s:e.hooks.helperMissing)?s.call(o,{name:"title",hash:{},data:t,loc:{start:{line:6,column:5},end:{line:6,column:14}}}):s)+"</h4>\n"+(null!=(r=i(n,"if").call(o,null!=l?i(l,"showCloseXButton"):l,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t,loc:{start:{line:7,column:1},end:{line:11,column:8}}}))?r:"")+"</header>\n"},useData:!0}),a={};e.Array.each([],(function(l){var n=e.Template.get("hermes/"+l);n&&(a[l]=n)})),e.Template.register("hermes/basic-closeable-header",(function(l,t){return(t=t||{}).partials=t.partials?e.merge(a,t.partials):a,n(l,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});