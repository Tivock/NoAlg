YUI.add("feed-new-page-view",(function(e,t){var o=require("hermes-core/flog")(t),i=new e.SubscriptionsHelper,n=e.config.flickr.moola.ad_breakpoint_mobile_desktop;e.namespace("Views")[this.name]=e.Base.create("feed-new-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.nsid=t.nsid,this.feedItemLists=[],this.feedItems={},this.itemModels=[],this.widowedItems=[],this.itemNodes={},this.cardViews={},this.batchJustifiedLayouts={},this.itemBoxes={},this.layoutType=t.layoutType,this.filterType=t.filterType,this.FILTER_TYPE_INTL={all:{intlName:"feed.NAV_ALL_ACTIVITY"},people:{intlName:"feed.NAV_PEOPLE_ONLY"},groups:{intlName:"feed.NAV_GROUPS_ONLY"},friends_and_family:{intlName:"feed.FRIENDS_AND_FAMILY"}},this.initialFeedUrl=YUI.Env.isServer?"":e.config.win.location.href,this.showFeedBannerAd=t.showFeedBannerAd,t.resetStoredBatchId&&e.StorageHelper.remove("currentFeedBatchId",!0),this.justifiedLayout=require("justified-layout"),this.helper=t.helper||new e.FeedHelper(this.appContext),this.photoCardHelper=t.photoCardHelper||new e.PhotoCardHelper(this.appContext),this.isMobileViewport=this.appContext.viewportData.getWidth()<=700,this.savedLayoutType=this.layoutType,this.layoutType=this.isMobileViewport?"large":this.layoutType,this.layoutValues=this.helper.layoutValues[this.layoutType],this.prevScrollTop=0,this.scrollDir=-1,this.railSpacerMargin=0,this.feedCardAdUnits=e.config.flickr.moola.positions.feed.slice(0,6),this.currentAdIndex=0,this.isHelloPro=t.isHelloPro},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"foot-banner-holder-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"feed-rail-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this,o=[];return o.push(this.appContext.getModel("person-models",this.nsid).then((function(e){t.viewerModel=e}))),o.push(this.appContext.getModel("feed-list-models",this.nsid).then((function(e){t.feedListModel=e,t.feedListModel.getValue("feedList")||(t.feedListModel.setValue("feedList",[]),t.feedListModel.setValue("beforeCount",Number.MAX_VALUE),t.feedListModel.setValue("afterCount",Number.MAX_VALUE))}))),e.Promise.all(o)},buildContainer:function(){this.setContainerWithTemplate("feed-new-page",{layoutType:this.layoutType,filterName:this.intlMessage(this.FILTER_TYPE_INTL[this.filterType]),showFeedBannerAd:this.showFeedBannerAd})},activate:function(){let t=new URL(e.url({host:window.location.host}));if(this.onCSSLoaded(this.handleCSSLoaded),this.isHelloPro)return this.appContext.getModel("person-models",this.nsid).then(function(e){this.showHelloProModal(e)}.bind(this));t.searchParams.delete("layoutType"),e.config.win.history.replaceState({},"",t.toString())},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),YUI.Env.isServer&&this.set("headContainer",e)},handleCSSLoaded:function(){var t=this,o=this.get("container");this.feedColumnNode=o.one(".feed-column"),this.loadTopButtonNode=this.feedColumnNode.one(".load-top-button"),this.feedColumnContentNode=this.feedColumnNode.one(".feed-column-content"),this.dummyLoaderNode=this.feedColumnNode.one(".dummy-loader-container"),this.toolsNode=o.one(".feed-new-tools-container"),this.filterMenuNode=this.toolsNode.one(".filter-menu-button"),this.infoColumnNode=o.one(".info-column"),this.infoColumnSpacer=o.one(".info-column-spacer"),this.infoColumnContentNode=this.infoColumnNode.one(".info-content-container"),this.loadErrorContainerNode=this.feedColumnNode.one(".feed-load-error-container"),this.scrollContainer=e.one("html"),this.containerHeight=this.appContext.viewportData.getHeight(),this.topLoader=this.feedColumnNode.one(".top-loader"),this.bottomLoader=this.feedColumnNode.one(".bottom-loader"),this.currentFeedColumnWidth=this.feedColumnContentNode.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:scroll",e.betterThrottle(this.handleScroll.bind(this),100,this,!1))),this.registerEventHandler(e.globalEvents.subscribe("window:scroll",e.betterThrottle(this.handleScrollSlow.bind(this),500,this,!1))),this.registerEventHandler(e.globalEvents.subscribe("window:scroll:nothrottle",this.handleScrollUnthrottled.bind(this))),this.registerEventHandler(this.loadTopButtonNode.on("click",this.handleLoadLatestClick.bind(this))),this.registerEventHandler(o.one(".layout-tabs").delegate("click",this.handleLayoutClick.bind(this),".tab")),this.registerEventHandler(e.on("groupStatusHelper:groupMuteToggled",(function(e){e.groupId&&t.toggleFadeGroupCards(e.groupId,e.isMuted)}))),this.registerEventHandler(e.on("groupStatusHelper:groupLeft",(function(e){e.groupId&&t.toggleFadeGroupCards(e.groupId,!0)}))),this.registerEventHandler(e.on("groupStatusHelper:groupJoined",(function(e){e.groupId&&t.toggleFadeGroupCards(e.groupId,!1)}))),this.registerEventHandler(this.filterMenuNode.on("click",this.handleFilterClick.bind(this))),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),this.registerEventHandler(e.on("history:change",(function(o){var i,n;"popstate"===o.src&&o.prevVal&&o.newVal&&(o.prevVal.flickr&&o.prevVal.flickr.referrer||o.newVal.flickr&&o.newVal.flickr.referrer)||(t.initialFeedUrl!==e.config.win.location.href?((i=t.getTopItemInView())&&e.StorageHelper.setItem("currentFeedBatchId",i.batchId,!0),n=new Date,t.feedListModel.setValue("expireTime",n.getTime()+12e4)):e.StorageHelper.remove("currentFeedBatchId",!0))}))),this.registerEventHandler(this.appContext.flapp.before("activeViewChange",(function(e){t.scrollContainer.set("scrollTop",0)}))),this.registerEventHandler(e.on("unload",(function(e){t.scrollContainer.set("scrollTop",0)})));var a=o.one(".feed-b");if(a){let t,o,s;t=e.config.flickr.moola.positions.billboard[0],s="asc",o={adUnit:t[this.appContext.viewportData.getWidth()<n?"ad_unit_mobile":"ad_unit_desktop"],upgradeProLink:i.getProLandingPageUrl(i.UTM_HIDE_ADS),class:"feed-ba"};var r=this.templates("prbd-moola-position")(o);a.set("innerHTML",r)}this.appContext.adManager.processAdsOnPage(),this.loadInitial()},loadInitial:function(){var t,o,i=this,n=0,a=[],r=e.StorageHelper.hasEntries("currentFeedBatchId",!0),s=new Date;if(r){t=e.StorageHelper.getItem("currentFeedBatchId",!0),e.StorageHelper.remove("currentFeedBatchId",!0);var l=this.feedListModel.getValue("feedList");return l&&l.length>=20&&s.getTime()<this.feedListModel.getValue("expireTime")?(this.updateStoredFeedListChunk(t,40,40),o=e.Promise.resolve({items:this.convertAndAddNewItems(this.feedListModel.getValue("feedList"),!1),beforeCount:this.feedListModel.getValue("beforeCount"),afterCount:this.feedListModel.getValue("afterCount")})):(this.clearFeedListModel(),o=this.loadMore({id:this.nsid,start:-17,end:20,batchId:t,isInitial:!0})),o.then((function(e){var t=e.items;return i.isAtTop=e.beforeCount<=0,i.isAtBottom=e.afterCount<=0,i.appContext.getModel("activity-models",i.nsid).then((function(e){return i.feedModel=e,t}))})).then((function(o){return i.hideDummyLoader(),0===o.length?(i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),e.Promise.resolve(o)):(1===o.length&&"ContactRec"===o[0].eventType&&i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),o.length>0&&(1===(n=o.map((function(e){return e.batchId})).indexOf(t))&&"ContactRec"===o[0].eventType&&(n=0),a=i.helper.generateListsFromItems(o)),i.appendNewItemLists(a).then((function(){return o})))})).then((function(){var o;i.isAtTop?i.toggleLoadTopButton(!1):i.toggleLoadTopButton(!0),0!==n&&(o=e.one('[data-batch-id="'+t+'"]'),setTimeout((function(){e.AnchorRepositioner.jumpTo(o,0)}),0),setTimeout((function(){i.isBatchStoringReady=!0}),1e3)),i.isInitiallyLoaded=!0}))}return this.loadMore({id:this.nsid,end:20,isInitial:!0}).then((function(t){var o=t.items,n=[];return i.isAtTop=t.beforeCount<=0,n.push(i.appContext.getModel("activity-models",i.nsid).then((function(e){return i.feedModel=e,o}))),e.Promise.all(n).then((function(e){return o}))})).then((function(t){var o;return i.hideDummyLoader(),0===t.length?(i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),e.Promise.resolve(t)):(1===t.length&&"ContactRec"===t[0].eventType&&i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),o=i.helper.generateListsFromItems(t),i.appendNewItemLists(o).then((function(){return t})))})).then((function(e){return i.isBatchStoringReady=!0,i.isInitiallyLoaded=!0,e}))},appendNewItemLists:function(e,t){var o=this,i=[];return this.isAppendingItems=!0,t&&e.reverse(),e.forEach((function(e){e.items.length>0&&(t?o.feedItemLists.unshift(e):o.feedItemLists.push(e),i.push((function(){return o.appendNewItems(e,t,t)})))})),this.helper.promiseSync(i).then((function(e){return o.isAppendingItems=!1,o.appContext.adManager.processAdsOnPage(),setTimeout((function(){Object.keys(o.feedItems).forEach((function(e){var t=o.feedItems[e];t.id in o.cardViews&&o.cardViews[t.id].setAwake(o.photoCardHelper.checkInsideViewport(o.cardViews[t.id].get("container"),200))}))}),0),e}))},handleScroll:function(){var e=this;this.isAppendingItems||(this.checkLoadMore(),Object.values(e.feedItems).forEach((function(t){t.id in e.cardViews&&t.id in e.itemNodes&&e.cardViews[t.id].setAwake(e.photoCardHelper.checkInsideViewport(e.cardViews[t.id].get("container"),200))})))},handleScrollSlow:function(){var t=this.getTopItemInView();this.isBatchStoringReady&&t&&e.StorageHelper.setItem("currentFeedBatchId",t.batchId,!0)},handleScrollUnthrottled:function(){var t,o=this.scrollContainer.get("scrollTop"),i=this.appContext.viewportData.getHeight(),n=e.AnchorRepositioner.getTotalOffset(),a=n+20;if(this.prevScrollTop>o){if(1===this.scrollDir){if(t=this.infoColumnNode.get("offsetTop"),this.railHeight=this.infoColumnContentNode.get("clientHeight"),this.railHeight<i-a)return this.infoColumnContentNode.setStyle("top",a),this.railSpacerMargin=0,void this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin);o+i-n-t>this.railHeight+this.railSpacerMargin&&(this.railSpacerMargin=Math.max(0,o+i-this.railHeight-t),this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin)),this.scrollDir=-1,this.infoColumnContentNode.setStyle("bottom",i-this.railHeight-a),this.infoColumnContentNode.setStyle("top","initial")}}else if(this.prevScrollTop<o&&-1===this.scrollDir){if(t=this.infoColumnNode.get("offsetTop"),this.railHeight=this.infoColumnContentNode.get("clientHeight"),this.railHeight<i-a)return this.infoColumnContentNode.setStyle("top",a),this.railSpacerMargin=0,void this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin);o-t+a<this.railSpacerMargin&&(this.railSpacerMargin=Math.max(0,o-t+a),this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin)),this.scrollDir=1,this.infoColumnContentNode.setStyle("bottom","initial"),this.infoColumnContentNode.setStyle("top",i-this.railHeight)}this.prevScrollTop=o},loadMore:function(t){var i=this;return this.isLoadingMore=!0,this.toggleListLoader("bottom",!0),e.Analytics.sendClick("Feed Load More Continuated: Bottom","Feed Load More Continuated"),(this.nextLoadContinuatedPromise?this.nextLoadContinuatedPromise:this.loadContinuated(t)).then((function(e){var t=e.activityModels,o=i.convertAndAddNewItems(t,!1),n=i.feedListModel.getValue("beforeCount"),a=i.feedListModel.getValue("afterCount");return i.feedListModel.setValue("feedList",i.feedListModel.getValue("feedList").concat(e.activityModels)),i.feedListModel.setValue("beforeCount",e.beforeCount<n?e.beforeCount:n),i.feedListModel.setValue("afterCount",e.afterCount<a?e.afterCount:a),i.isAtBottom=e.afterCount<=0,{items:o,beforeCount:e.beforeCount,afterCount:e.afterCount}})).then((function(e){return i.isLoadingMore=!1,i.toggleListLoader("bottom",!1),i.isAtBottom||(i.nextLoadContinuatedPromise=i.loadContinuated({start:1,end:50,batchId:e.items.length>0?e.items[e.items.length-1].batchId:void 0})),e})).catch((function(e){throw o.error("Error loading more feed items",{err:e}),i.isLoadingMore=!1,i.toggleListLoader("bottom",!1),e}))},loadMoreBefore:function(){var t=this;return this.isLoadingMore=!0,this.toggleListLoader("top",!0),e.Analytics.sendClick("Feed Load More Continuated: Top","Feed Load More Continuated"),this.loadContinuated({start:-20,end:-1,batchId:this.itemModels.length>0?this.itemModels[0].id:void 0}).then((function(o){var i=o.activityModels;return 0===i.length||1===i.length&&i[0].id===t.itemModels[0].id?(t.isAtTop=!0,e.Promise.resolve()):{items:t.convertAndAddNewItems(i,!0),beforeCount:o.beforeCount}})).then((function(e){return t.isLoadingMore=!1,t.toggleListLoader("top",!1),e})).catch((function(e){throw o.error("Error loading more feed items",{err:e}),t.isLoadingMore=!1,t.toggleListLoader("top",!1),e}))},appendNewItems:function(e,t,o){return this.buildLayout(e,t,o)},buildLayout:function(e,t,o){return"people"===e.layoutRenderType?this.buildPeopleCardLayout(e.items,t,o):"ad"===e.layoutRenderType?this.buildAdCardLayout(e.items,t,o):(t||(this.widowedItems.forEach((function(t){e.items.unshift(t)})),this.widowedItems=[]),this.buildPhotoCardLayout(e.items,t,o))},buildPeopleCardLayout:function(t,o,i){var n=this,a=t[0];return n.appContext.getView("people-card-view",{id:a.id,item:a,personItems:a.personItems}).then((function(e){return e.initialize()})).then((function(t){var i=e.Node.create('<div class="feed-layout"></div>'),r=e.Node.create('<div class="feed-item" data-batch-id="'+a.batchId+'" data-batch-id="'+a.batchId+'"></div>');return i.setStyle("position","relative"),i.setStyle("margin-bottom",n.layoutValues.CARD_SPACING),r.appendChild(t.get("container")),i.appendChild(r),o?n.feedColumnContentNode.prepend(i):n.feedColumnContentNode.append(i),n.registerEventHandler(t.on("batchLayoutMoreClicked",n.showBatchOverlay.bind(n))),t.activate().then((function(){return e.Snowplough.sendStructuredEvent({category:"onboarding",action:"show",label:"people_card",value:0}),i}))}))},buildAdCardLayout:function(t,o,a){var r=this,s=t[0],l=e.Node.create('<div class="feed-layout"></div>'),d=this.appContext.viewportData.getWidth()<=n,h=this.templates("ad-card")({adConfig:{adUnit:d?s.adConfig.ad_unit_mobile:s.adConfig.ad_unit_desktop,upgradeProLink:i.getProLandingPageUrl(i.UTM_HIDE_ADS)},upsellFallback:!0,theme:"compact"===this.layoutType?"flat":void 0}),u=e.Node.create('<div class="feed-item" data-item-id="'+s.id+'">'+h+"</div>");return l.setStyle("margin-bottom",r.layoutValues.CARD_SPACING),l.appendChild(u),o?r.feedColumnContentNode.prepend(l):r.feedColumnContentNode.append(l),e.Promise.resolve(l)},buildPhotoCardLayout:function(t,o,i){var n,a=this,r=a.layoutType,s=[],l=e.Node.create('<div class="feed-layout"></div>');return l.setStyle("position","relative"),"large"===r?t.forEach((function(e){var t=e.photoItems[0].aspectRatio,o=a.feedColumnContentNode.get("clientWidth"),i=a.helper.getCappedPhotoHeight({height:o/t,additionalCardHeight:a.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+a.photoCardHelper.DETAILS_FOOTER_HEIGHT+a.photoCardHelper.INFO_BAR_HEIGHT,minHeight:200,viewportProportion:1});a.itemBoxes[e.id]={aspectRatio:t,width:o,height:i}})):"medium"===r&&(n=this.prepareMediumLayout(t,i),l.setStyle("height",n.containerHeight),l.setStyle("margin-bottom",this.layoutValues.CARD_SPACING)),t.forEach((function(e,t){var o=a.itemBoxes[e.id],i=e.photoItems[0],n=a.batchJustifiedLayouts[e.id],l=e.photoItems.length>1||"compact"===r,d=a.helper.getItemAttribution(e),h=(l||"GroupBatch"===e.eventType)&&"compact"!==r,u=a.helper.getLinkFooterConfig(e),c="/in/feed-"+e.batchId,p=!l&&"GroupBatch"===e.eventType,f={};"GroupBatch"===e.eventType?(f.type="Group",f.groupId=e.groupId,f.eventType=e.eventType,f.isFaded=e.isFaded):e.photoItems.length>1?(f.type="PersonBatch",f.owner=e.photoItems[0].owner,f.photoId=e.photoItems[0].photoId):(f.type="Person",f.owner=e.photoItems[0].owner,f.photoId=e.photoItems[0].photoId),s.push(a.appContext.getView("photo-card-view",{item:e,feedHelper:a.helper,showHeader:!0,isBatchLayout:l,showLinkFooter:h,showDetailsFooter:!h&&"large"===r,showInfoBar:!h&&!l&&"compact"!==r,showInfoBarTitle:"medium"===r||"compact"===r,showInfoBarViews:"large"===r,batchLayout:n,isFaded:e.isFaded,box:o,cardType:r,theme:"compact"===r?"flat":void 0,batchConfig:{layoutType:r,photoConfig:{showDetailsFooterOverlay:"large"===r,showInfoBarOverlay:!0,showHeadOverlay:"GroupBatch"===e.eventType,showInfoBarTitle:"medium"===r||"compact"===r,showInfoBarViews:"large"===r,shouldContain:!1,urlContext:c,hasHoverPlay:!1}},headerConfig:{title:d.title,url:d.url,iconUrl:d.iconUrl,time:d.time,activityName:d.activityName,isCompact:"compact"===r,isGroupAttribution:"GroupBatch"===e.eventType,isPersonAttribution:"UploadBatch"===e.eventType,attributionId:d.id,showProBadge:d.isPro,proBadgeType:d.proBadgeType,showMenu:!0,menuConfig:f},photoConfig:{photoItem:i,box:o,showDetailsFooterOverlay:"large"===r&&p,showInfoBarOverlay:p,showInfoBarTitle:"medium"===r||"compact"===r,showInfoBarViews:"large"===r,shouldContain:"large"===r,urlContext:c,showPhotoInterstitial:i.needsInterstitial,photoInterstitialContent:i.needsInterstitial?a.templates("adult-content-photo-overlay")({isCompact:"compact"===r,photoUrl:i.url+c}):void 0,hasHoverPlay:i.isVideo,showHeadOverlay:p,headerConfig:p?{title:i.owner.displayname,url:"/photos/"+i.owner.pathAlias,iconUrl:i.owner.buddyicon.default,isPersonAttribution:!0,attributionId:i.owner.nsid,isCompact:!0,showMenu:!1,theme:"overlay",showProBadge:i.owner.isPro,proBadgeType:i.owner.proBadgeType}:void 0},linkFooterConfig:u}).then((function(e){return e.initialize()})))})),e.Promise.all(s).then((function(t){var i=[];return t.forEach((function(t,o){var i=t.params.item,n=a.itemBoxes[i.id],s=t.get("container"),d=e.Node.create('<div class="feed-item" data-item-id="'+i.id+'" data-batch-id="'+i.batchId+'"></div>');"large"===r?d.setStyle("margin-bottom",a.isMobileViewport?a.layoutValues.CARD_SPACING_MOBILE:a.layoutValues.CARD_SPACING):"medium"===r?(d.setStyle("position","absolute"),d.setStyle("flex-direction","column"),d.setStyle("top",n.top),d.setStyle("left",n.left),d.setStyle("width",n.width),d.setStyle("height",n.height+a.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+a.photoCardHelper.INFO_BAR_HEIGHT)):"compact"===r&&d.setStyle("margin-bottom",a.layoutValues.CARD_SPACING),d.appendChild(s),l.appendChild(d),a.itemNodes[i.id]=d,a.cardViews[i.id]=t,a.registerEventHandler(t.on("batchLayoutMoreClicked",a.showBatchOverlay.bind(a)))})),o?a.feedColumnContentNode.prepend(l):a.feedColumnContentNode.append(l),t.forEach((function(e,t){i.push(e.activate())})),e.Promise.all(i).then((function(){return l}))}))},prepareMediumLayout:function(e,t){var o,i=this,n=[],a=this.helper.layoutValues[this.layoutType].MAX_BATCH_AR,r=this.helper.layoutValues[this.layoutType].MIN_BATCH_AR;return e.forEach((function(e){var t,o,s,l=[],d=[];if(1===e.photoItems.length)n.push(e.photoItems[0].aspectRatio);else{if(l=(l=e.photoItems.map((function(e){return i.photoCardHelper.getClampedPhotoAspectRatio(e.aspectRatio)}))).slice(0,5),(o=i.justifiedLayout(l,{containerWidth:i.layoutValues.GENERATED_LAYOUT_WIDTH,containerPadding:0,boxSpacing:{horizontal:i.layoutValues.GENERATED_LAYOUT_SPACING,vertical:i.layoutValues.GENERATED_LAYOUT_SPACING},targetRowHeight:i.layoutValues.GENERATED_LAYOUT_ROW_HEIGHT_RATIO*i.layoutValues.GENERATED_LAYOUT_WIDTH,targetRowHeightTolerance:i.layoutValues.GENERATED_LAYOUT_TARGET_ROW_HEIGHT_TOLERANCE,maxNumRows:2})).width=i.layoutValues.GENERATED_LAYOUT_WIDTH,s=void 0,o.boxes.forEach((function(e,t){e.top!==s&&(s=e.top,d.push(t))})),2===d.length&&o.widowCount>0&&((o=i.justifiedLayout(l.slice(0,2),{containerWidth:i.layoutValues.GENERATED_LAYOUT_WIDTH,containerPadding:0,boxSpacing:{horizontal:i.layoutValues.GENERATED_LAYOUT_SPACING,vertical:i.layoutValues.GENERATED_LAYOUT_SPACING},targetRowHeight:i.layoutValues.GENERATED_LAYOUT_ROW_HEIGHT_RATIO*i.layoutValues.GENERATED_LAYOUT_WIDTH,targetRowHeightTolerance:i.layoutValues.GENERATED_LAYOUT_TARGET_ROW_HEIGHT_TOLERANCE,maxNumRows:1})).width=i.layoutValues.GENERATED_LAYOUT_WIDTH,d=[],s=void 0,o.boxes.forEach((function(e,t){e.top!==s&&(s=e.top,d.push(t))}))),1===d.length&&o.widowCount===o.boxes.length){var h=o.boxes.reduce((function(e,t,n){var a=n!==o.boxes.length-1?i.layoutValues.GENERATED_LAYOUT_SPACING:0;return e+t.width+a}),0),u=o.width/h;o.boxes.forEach((function(e,t){e.width*=u,e.height*=u,e.left*=u})),o.containerHeight*=u}(t=o.width/o.containerHeight)>a?(o=i.photoCardHelper.scaleLayout(o,t/a,i.layoutValues.GENERATED_LAYOUT_SPACING,!0,!1),t=a):t<r&&(o=i.photoCardHelper.scaleLayout(o,r/t,i.layoutValues.GENERATED_LAYOUT_SPACING,!1,!0),t=r),i.batchJustifiedLayouts[e.id]=o,n.push(t)}})),(o=this.justifiedLayout(n,{containerWidth:this.feedColumnContentNode.get("clientWidth"),containerPadding:0,boxSpacing:{horizontal:this.layoutValues.CARD_SPACING,vertical:this.layoutValues.CARD_SPACING+this.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+this.photoCardHelper.INFO_BAR_HEIGHT},targetRowHeight:this.isMobileViewport?this.layoutValues.TARGET_ROW_HEIGHT_MOBILE:this.layoutValues.TARGET_ROW_HEIGHT,targetRowHeightTolerance:this.layoutValues.TARGET_ROW_HEIGHT_TOLERANCE,showWidows:t})).containerHeight+=this.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+this.photoCardHelper.INFO_BAR_HEIGHT,t||(this.widowedItems=e.splice(o.boxes.length)),o.boxes.forEach((function(t,o){i.itemBoxes[e[o].id]=t})),o},convertAndAddNewItems:function(t,o){var i,n,a,r=this,s=[];if(t.forEach((function(e){s.push(r.helper.convertActivityModel(e))})),!this.appContext.getViewer().isPro)for(i=this.helper.AD_CADENCE;i<s.length;i+=7)n=this.feedCardAdUnits[this.currentAdIndex++%6],a={id:e.guid(),eventType:"ad",adConfig:n},s.splice(i,0,a);return o?(this.itemModels=t.concat(this.itemModels),s.forEach((function(e){r.feedItems[e.id]=e}))):(this.itemModels=this.itemModels.concat(t),s.forEach((function(e){r.feedItems[e.id]=e}))),s},hideOutsideRows:function(){},checkLoadMore:function(){var e=this,t=this.scrollContainer.get("scrollTop"),o=this.scrollContainer.get("scrollHeight");!this.isLoadingMore&&t+this.containerHeight+4e3>o&&!this.isAtBottom&&this.loadMore({start:1,end:50,batchId:this.itemModels.length>0?this.itemModels[this.itemModels.length-1].id:void 0}).then((function(t){var o=[];t.items.length>0&&(o=e.helper.generateListsFromItems(t.items)),e.appendNewItemLists(o)}))},toggleLoadTopButton:function(e){this.loadTopButtonNode.toggleClass("hidden",!e)},handleLoadLatestClick:function(){var t=this;if(!this.isLoadingMore)return this.clearFeedListModel(),this.toggleListLoader("top",!0),e.Analytics.sendClick("Feed Load More Continuated: Top","Feed Load More Continuated"),this.loadMore({id:this.nsid,end:20}).then((function(e){var o=e.items;return t.isAtTop=e.beforeCount<=0,o})).then((function(o){var i;return t.toggleListLoader("top",!1),0===o.length?(t.showLoadError(!0,t.helper.getEmptyStateMessage(t.filterType,t.viewerModel)),e.Promise.resolve(o)):(i=t.helper.generateListsFromItems(o),t.relayoutItems(i).then((function(){return t.isAtTop?t.toggleLoadTopButton(!1):t.toggleLoadTopButton(!0),o})))})).catch((function(e){t.toggleListLoader("top",!1)}))},handleLoadTopClick:function(){var t=this;if(!this.isLoadingMore){var o=this.feedItemLists[0].items[0];e.one('[data-batch-id="'+o.batchId+'"]');this.loadMoreBefore().then((function(o){var i=[];return t.isAtTop=o.beforeCount<=0,o.items?(o.items.length>0&&(i=t.helper.generateListsFromItems(o.items)),t.appendNewItemLists(i,!0).then((function(){return o.items}))):e.Promise.resolve()})).then((function(o){t.isAtTop?t.toggleLoadTopButton(!1):t.toggleLoadTopButton(!0),o.length>0&&setTimeout((function(){e.AnchorRepositioner.jumpTo(t.itemNodes[o[o.length-1].id],0)}),0)}))}},loadContinuated:function(t){return e.ListFetchers["flickr-feed-getFeed"].run(Object.assign({perBatch:this.helper.PER_BATCH,eventTypes:this.helper.getEventTypes(this.filterType),relationshipFilter:"friends_and_family"===this.filterType?4:null,compact:"compact"===this.layoutType?1:0},t),this.appContext).catch((function(e){throw o.error("Error loading more feed items",{err:e}),e}))},getTopItemInView:function(){var e=this;return Object.values(e.feedItems).find((function(t){var o=t.batchId?e.itemNodes[t.id]:void 0,i=o?o.getDOMNode().getBoundingClientRect():void 0;if(i&&i.height>0&&i.top>=0&&i.top<=window.innerHeight)return!0}))},handleLayoutClick:function(e){e.target.ancestor('[data-layout-type="compact"]',!0)?this.changeLayout("compact",!0):e.target.ancestor('[data-layout-type="medium"]',!0)?this.changeLayout("medium",!0):e.target.ancestor('[data-layout-type="large"]',!0)&&this.changeLayout("large",!0)},changeLayout:function(t,i){var n=this,a={},r=this.layoutType!==t&&("compact"===t||"compact"===this.layoutType);this.layoutType=t,this.layoutValues=this.helper.layoutValues[this.layoutType],i&&(a.feed_layout_type=this.layoutType,this.appContext.callAPI("flickr.prefs.setPrefs",a).then((function(){n.savedLayoutType=n.layoutType,e.Analytics.sendClick("Feed Layout Type: "+n.layoutType,"Feed Layout Type Changed")}),(function(e){o.error("Error changing user prefs",{err:e})}))),this.setLayoutTabSelected(t),r?(this.clearFeedListModel(),e.StorageHelper.remove("currentFeedBatchId",!0),this.handleLoadLatestClick()):this.relayoutItems()},relayoutItems:function(t){var o=t||this.feedItemLists.slice(0);if(!this.isInitiallyLoaded||this.isLoadErrorState)return e.Promise.reject();for(var i in this.feedColumnContentNode.setHTML(""),this.widowedItems=[],this.batchJustifiedLayouts={},this.itemBoxes={},this.itemNodes={},this.cardViews={},this.feedItemLists=[],this.cardViews)i in this.cardViews&&this.cardViews[i].destroy();return o=o.map((e=>({layoutRenderType:e.layoutRenderType,items:e.items.map((e=>e.model?this.helper.convertActivityModel(e.model):e))}))),this.appendNewItemLists(o)},setLayoutTabSelected:function(e){this.get("container").one(".layout-tabs").all(".tab").each((function(t){t.toggleClass("selected",t.getAttribute("data-layout-type")===e)}))},hideDummyLoader:function(){var e=this;this.dummyLoaderNode.addClass("fading"),setTimeout((function(){e.dummyLoaderNode.remove()}),500)},toggleListLoader:function(e,t){"bottom"===e?this.bottomLoader.toggleClass("hidden",!t):"top"===e&&this.topLoader.toggleClass("hidden",!t)},handleFilterClick:function(t){var i=this,n={},a=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,preferBottom:!0,anchorElement:this.filterMenuNode.one(".arrow"),keyboardAnchorElement:this.filterMenuNode,closeOnScroll:!0,menuItems:[{text:this.intlMessage(this.FILTER_TYPE_INTL.all),value:"all",isSelected:"all"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.people),value:"people",isSelected:"people"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.groups),value:"groups",isSelected:"groups"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.friends_and_family),value:"friends_and_family",isSelected:"friends_and_family"===this.filterType}]});a.show(),this.registerEventHandler(a.on("selected",(function(t){t&&t.menuItem&&(i.filterMenuNode.one(".filter-menu-text").set("text",i.intlMessage(i.FILTER_TYPE_INTL[t.menuItem.value])),n.feed_filter_type=t.menuItem.value,i.layoutType=t.menuItem.value,i.appContext.callAPI("flickr.prefs.setPrefs",n).then((function(o){e.Analytics.sendClick("Feed Filter Type: "+t.menuItem.value,"Feed Filter Type Changed"),i.clearFeedListModel(),i.appContext.flapp.navigate(e.config.win.location.href)}),(function(e){o.error("Error setting feed user prefs",{err:e})}))),a.close()})),this)},handlePageResize:function(){var e=this,t=this.appContext.viewportData.getWidth()<=700,o=this.feedColumnContentNode.get("clientWidth");if(o!==this.currentFeedColumnWidth){if(this.currentFeedColumnWidth=o,this.isMobileViewport===t)return this.isResizing||(this.resizeScrollTop=this.scrollContainer.get("scrollTop"),this.isResizing=!0),this.relayoutItems().then((function(){setTimeout((function(){e.resizeScrollTop&&e.scrollContainer.set("scrollTop",e.resizeScrollTop),e.isResizing=!1}),50)}));t?this.changeLayout("large",!1):this.changeLayout(this.savedLayoutType,!1),this.isMobileViewport=t}},destructor:function(){e.one("body").setStyle("overflow","initial")},showBatchOverlay:function(t){var o=this;return("batchPeople"===t.layoutType?this.appContext.getView("feed-people-batch-view",{feedItem:Object.values(o.feedItems).find((function(e){return e.id===t.itemId})),feedHelper:this.helper,layoutType:t.layoutType,headerText:this.intlMessage({intlName:"feed.PEOPLE_TO_FOLLOW"})}):this.appContext.getView("feed-batch-view",{feedItem:Object.values(o.feedItems).find((function(e){return e.id===t.itemId})),feedHelper:this.helper,layoutType:t.layoutType})).then((function(e){return e.initialize()})).then((function(t){o.batchOverlayId=o.appContext.overlayManager.push({view:t,disableBodyScroll:!0,dismissOnEsc:!0}),o.appContext.overlayManager.placeViewAfterOverlay(o.batchOverlayId),setTimeout((function(){t.get("container").addClass("active")}),0),o.registerEventHandler(t.on("close",(function(){o.appContext.overlayManager.pop(o.batchOverlayId),e.Analytics.sendClick("Feed Batch Overlay Closed")}))),t.normalizedActivate()}))},showLoadError:function(e,t){t&&this.loadErrorContainerNode.set("innerHTML",t),this.loadErrorContainerNode.toggleClass("hidden",!e),this.isLoadErrorState=e},toggleFadeGroupCards:function(e,t){var o=this;Object.values(this.feedItems).forEach((function(i){var n=o.cardViews[i.id];n&&i.groupId===e&&(i.isFaded=t,n.toggleFaded(t))}))},clearFeedListModel:function(){this.feedListModel.setValue("feedList",[]),this.feedListModel.setValue("beforeCount",Number.MAX_VALUE),this.feedListModel.setValue("afterCount",Number.MAX_VALUE),this.nextLoadContinuatedPromise=void 0},updateStoredFeedListChunk:function(e,t,o){var i,n,a,r=this.feedListModel.getValue("feedList"),s=r.length,l=0;r.find((function(t,o){if(t.getValue("id")===e)return l=o,!0})),
i=Math.max(l-t,0),n=Math.min(l+o,r.length),a=r.slice(i,n),this.feedListModel.setValue("feedList",a),this.feedListModel.setValue("beforeCount",this.feedListModel.getValue("beforeCount")+i),this.feedListModel.setValue("afterCount",this.feedListModel.getValue("afterCount")+(s-n))},showHelloProModal:function(t){var o=e.URLHelper.generatePersonUrls(t),i=new e.Views.FluidModal({actionButtonLabel:this.intlMessage({intlName:"checkout.OK_THANKS"}),htmlMessage:this.templates("pro-hello-pro")({photostreamURL:e.url(o.photostream)}),showBodyLines:!0,showHeader:!1,appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,actionButtonDisabled:!1,actionButtonIsDangerous:!1,showCancelButton:!1,classList:"welcome-pro-modal",showCancelX:!1});i.on("activated",(function(t){let o=new URL(e.url({host:window.location.host}));o.searchParams.delete("helloPro"),setTimeout((function(){e.config.win.history.replaceState({},"",o.toString())}),1e3)})),i.on("actionClick",(function(e){i.close()})),i.show()}})}),"@VERSION@",{requires:["flickr-view","photo-card-view","people-card-view","feed-rail-view","hermes-template-feed-new-page","hermes-template-head-meta","hermes-template-adult-content-photo-overlay","hermes-template-ad-card","flickr-feed-getFeed-fetcher","feed-helper","photo-card-helper","storage-helper","url-helper","subscriptions-helper","url","fluid-modal-view"],optionalRequires:["hermes-core"],langBundles:["common","blurb","fave-view","share-modal","comments","relative-dates","feed","adult-content-overlay","checkout"]});YUI.add("feed-list-models",(function(e,t){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,attributes:{feedList:[],beforeCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:void 0},afterCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:void 0},expireTime:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:void 0}}},{})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise"],langBundles:["models"]});YUI.add("hermes-lang-blurb",(function(e,o){e.Intl.add("hermes/blurb","en-US",{ALL_NEW_BOOKS_HEADER:[{type:0,value:"All-new photos books from Blurb"}],ALL_NEW_BOOKS_SUBHEADER_PRO:[{type:0,value:"Get $35 off your Blurb® purchase.* Use your discount code below at checkout."}],ALL_NEW_BOOKS_SUBHEADER_NONPRO:[{type:0,value:'Get $35 off your Blurb® purchase.* <a href="'},{type:1,value:"url"},{type:0,value:'">Learn more</a>'}],GET_DISCOUNT_WITH_PRO:[{type:0,value:"Get $35 off with your Flickr Pro subscription"}],PRINT_WITH_BLURB:[{type:0,value:"Print your photo books with Blurb®."}],ASTERIX:[{type:0,value:"* With minimum purchase of $70. Offer available for 1-year and 2-year Flickr Pro subscriptions. Discount available once per year."}],ASTERIX_V2:[{type:0,value:"* Get $35 dollars off your Photo Book purchase up to 4 times a year! Valid for orders of $70 or more when you’re on an annual Flickr Pro plan."}],ASTERIX_MINIMUM:[{type:0,value:"* With minimum purchase of $70."}],ALL_NEW_BOOKS_SUBHEADER_2:[{type:0,value:"Use your discount code below at checkout."}],LAUNCH_BlURB_BOOKIFY:[{type:0,value:"Launch Blurb Bookify"}],CUSTOMIZE_BOOK_HEADER:[{type:0,value:"Customize your book."}],MAKE_A_BOOK:[{type:0,value:"Make a book"}],COLUMNS_CREATE:[{type:0,value:"Create."}],COLUMNS_CREATE_TEXT:[{type:0,value:"Connect your Flickr account to Blurb and start your book. You can easily import your photostream and albums into the book layout."}],COLUMNS_PRINT:[{type:0,value:"Print."}],COLUMNS_PRINT_TEXT:[{type:0,value:"Get all the options you need for your project, including digital output, print on demand, and offset printing. Plus, choose from a wide range of paper options. It’s all up to you."}],COLUMNS_SELL:[{type:0,value:"Sell."}],COLUMNS_SELL_TEXT:[{type:0,value:'Choose from a range of distribution options, including Amazon, Ingram, and the Blurb Bookstore. As a Flickr Pro, you can now promote your books on Flickr as well. <a href="'},{type:1,value:"url"},{type:0,value:'">Learn more</a>'}],COLUMNS_CUSTOMIZE:[{type:0,value:"Customize."}],COLUMNS_CUSTOMIZE_TEXT:[{type:0,value:"Take advantage of Blurb’s many sizes, paper choices, and styles. Unleash your creativity with captions, text, and countless photo layouts."}],ANOTHER_STUNNING_SHOT:[{type:0,value:"Another stunning photo shoot!"}],WANT_MORE_CREATIVE:[{type:0,value:"Want more creative control?"}],USE_FAVORITE_TOOLS:[{type:0,value:"Use your favorite Adobe & PDF tools."}],CREATIVE_TEXT:[{type:0,value:'Lay out your book, magazine, or ebook with your favorite tools. Get easy print setup with Blurb’s plug-in for Adobe InDesign and Adobe Lightroom Book Module. Or, design with any app and use Blurb’s PDF uploader. <a href="'},{type:1,value:"url"},{type:0,value:'">Learn more</a>'}],BLURB_SHARE:[{type:0,value:"Share."}],BLURB_SHARE_TEXT:[{type:0,value:"Once you receive your Blurb book, share it with the Flickr community. Join the official Blurb Books group on Flickr and inspire others with your creations."}],BLURB_BULLET_LIST_ONE:[{type:0,value:"1"}],BLURB_BULLET_LIST_SECOND:[{type:0,value:"2"}],BLURB_BULLET_LIST_THIRD:[{type:0,value:"3"}],UPGRADE_TO_PRO_BTN:[{type:0,value:"Upgrade to Pro"}],UPGRADE_YOUR_PRO_BTN:[{type:0,value:"Upgrade your Pro"}],COPY_BLURB_CODE:[{type:0,value:"Copy"}],COPY_COPIED:[{type:0,value:"Copied!"}],PHOTO_BOOKS:[{type:0,value:"Photo Books"}],PRO_BLURB_SECTION_TEXT:[{type:0,value:"Use Blurb’s free book-creation tools for complete creative control. Get $35 off your first Blurb purchase with a yearly Pro subscription (minimum $70 Blurb purchase)."}],BLURB_PRODUCT_PROMO_DESCRIPTION_TEXT:[{type:0,value:"Use Blurb’s free book-creation tools for complete creative control. Get $35 dollars off your Photo Book purchase up to 4 times a year. Valid for orders of $70 or more."}]})}),"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-fave-view",(function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:[{type:0,value:"We couldn’t fave at this time"}],SIGN_IN_TO_FAVE:[{type:0,value:"You must be signed in to fave. Please sign in now."}],LOADING_FAVES:[{type:0,value:"Loading Faves..."}],UNFAVE_PHOTO:[{type:0,value:"Unfave this photo"}],FAVE_PHOTO:[{type:0,value:"Fave this photo"}],WHO_FAVED:[{type:0,value:"Who faved this photo"}],SIGN_IN_BEFORE_FAVE_TITLE:[{type:0,value:"You found a photo to fave!"}],SIGN_IN_BEFORE_FAVE_MESSAGE:[{type:0,value:"That’s great. Just sign in to fave it."}],SIGN_IN_AND_FAVE:[{type:0,value:"Sign in and fave"}],JOIN_FLICKR_AND_FAVE:[{type:0,value:"Join Flickr to add this photo to your favorites."}]})}),"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-comments",(function(e,t){e.Intl.add("hermes/comments","en-US",{LOADING:[{type:0,value:"Loading"}],MORE:[{type:0,value:"more"}],ERROR_LOADING_COMMENTS:[{type:0,value:"Error loading comments"}],COULDNT_POST_COMMENT:[{type:0,value:"We couldn’t post your comment"}],COULDNT_GET_MORE_COMMENTS:[{type:0,value:"We couldn’t get more comments"}],CONFIRM_DELETE:[{type:0,value:"Confirm Delete"}],YES_CONFIRM_DELETE:[{type:0,value:"Yes, Delete It"}],ARE_YOU_SURE_DELETE:[{type:0,value:"Are you sure you want to delete this comment?"}],COULDNT_DELETE_COMMENT:[{type:0,value:"We couldn’t delete your comment"}],ERROR:[{type:0,value:"Error!"}],NO_COMMENTS:[{type:0,value:"No comments"}],ADD_A_COMMENT:[{type:0,value:"Add a comment"}],LOGIN_TO_COMMENT:[{type:0,value:"Login to comment"}],MUST_BE_LOGGED_IN_TO_COMMENT:[{type:0,value:"You must be logged in to post a comment"}],LOADING_COMMENTS:[{type:0,value:"Loading comments..."}],SEE_MORE:[{type:0,value:"See more"}],SEE_MORE_LINK:[{type:0,value:'... <a href="'},{type:1,value:"photoUrl"},{type:0,value:'">Read more</a>'}],SIGNUP_MODAL_TITLE:[{type:0,value:"Comment on this photo!"}],SIGNUP_MODAL_MESSAGE:[{type:0,value:"Join Flickr to leave a comment on this photo"}],VIEW_COMMENTS:[{type:0,value:"View Comments"}],COMMENTING_DISABLED:[{type:0,value:"Commenting is disabled for this photo."}],VIEW_ON_PHOTO_PAGE:[{type:0,value:"View all comments on the photo page"}],ADD_GALLERY_COMMENT:[{type:0,value:"Add a comment about this gallery"}],ADD_PHOTO_COMMENT:[{type:0,value:"Add a comment about this "},{type:5,value:"mediaType",options:{photo:{value:[{type:0,value:"photo"}]},video:{value:[{type:0,value:"video"}]},other:{value:[{type:0,value:"photo"}]}}}],SELECT_EMOJI:[{type:0,value:"Select emoji"}]})}),"@VERSION@",{requires:["intl"]});